<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">     
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詞綴收益計算</title>
    <link rel="shortcut icon" href="./img/favicon32.ico" type="image/x-icon">
    <link rel="stylesheet" href="./css/style.css">
    <!-- bootstrap-4.5.0-dist -->
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script src="./js/jquery-3.5.1.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
</head>
<body onload="reburn_teriri()">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12">
                <h1 class="text-center">詞綴收益計算</h1>
            </div>
        </div>       
        <div class="row justify-content-center">
            <table class="table table-striped table-borderless table-sm table-dark col-lg-5 col-11">       
                <tr>
                    <td class="text "><label for="level">女武神等級</label></td>
                    <td class="number text-right"><input type="number" id="level" value="80" min="1" max="80"></td>
                </tr>
                <tr>
                    <td class="text "><label for="atk">攻擊</label></td>
                    <td class="number text-right"><input type="number" id="atk" min="1"></td>
                </tr>
                <tr>
                    <td class="text "><label for="crt">會心</label></td>
                    <td class="number text-right"><input type="number" id="crt" min="1"></td>
                </tr>
                <tr>
                    <td class="text "><label for="crit_rate">爆擊率加成</label></td>
                    <td class="number text-right"><input type="number" id="crit_rate" min="0" step="0.1">%</td>
                </tr>
                <tr>
                    <td class="text "><label for="crit_dmg">爆擊傷害加成</label></td>
                    <td class="number text-right"><input type="number" id="crit_dmg" min="0" step="0.1">%</td>
                </tr>
                <tr>
                    <td class="text result">最終爆擊率</td>
                    <td class="number text-right result"><span id="final_crit_rate">0</span> %</td>
                </tr>
                <tr>
                    <td class="text "><img src="./img/VEL03.png" alt="三星詞綴" title="詞綴"><label for="affix_atk">攻擊</label></td>
                    <td class="number text-right"><input type="number" id="affix_atk" min="0" step="0.1"></td>
                </tr>
                <tr>
                    <td class="text "><img src="./img/VEL03.png" alt="三星詞綴" title="詞綴"><label for="affix_crt">會心</label></td>
                    <td class="number text-right"><input type="number" id="affix_crt" min="0" step="0.1"></td>
                </tr>
                <tr>
                    <td class="text "><img src="./img/VEL03.png" alt="三星詞綴" title="詞綴"><label for="affix_crit_dmg">爆擊傷害</label></td>
                    <td class="number text-right"><input type="number" id="affix_crit_dmg" min="0" step="0.01">%</td>
                </tr>
                <tr>
                    <td class="text result">詞綴最終爆擊率</td>
                    <td class="number text-right result"><span id="affix_final_crit_rate">0</span> %</td>
                </tr>
                <tr>
                    <td class="text result">詞綴期望提升</td>
                    <td class="number text-right result"><span id="exp_up">0</span> %</td>
                </tr>
                <tr>
                    <td class="text result">詞綴提升上限<small>(全爆擊)</small></td>
                    <td class="number text-right result"><span id="limit_up">0</span> %</td>
                </tr>
            </table>
        </div>
    </div>

</body>
<script>
    $('table').delegate('input', 'change', function () {
        var level = Number($('#level').val());
        var atk = Number($('#atk').val());
        var crt =  Number($('#crt').val());
        var crit_rate =  Number($('#crit_rate').val());
        var crit_dmg = Number($('#crit_dmg').val());
        var final_crit_rate = $('#final_crit_rate');

        var affix_atk = Number($('#affix_atk').val());
        var affix_crt = Number($('#affix_crt').val());
        var affix_crit_dmg = Number($('#affix_crit_dmg').val());
        var affix_final_crit_rate = $('#affix_final_crit_rate');

        var exp_dmg = $('#exp_dmg');
        var affix_exp_dmg = $('#affix_exp_dmg');
        var exp_up = $('#exp_up');
        var limit_up = $('#limit_up');

        fcr = Math.floor( crt/(level*5 + 75)*100 ) + crit_rate;
        affix_fcr = Math.floor( (crt + affix_crt)/(level*5 + 75)*100 ) + crit_rate;
        if( fcr > 100 ){
            final_crit_rate.text(100);    
            affix_final_crit_rate.text(100);
        }else if( affix_fcr > 100 ){
            affix_final_crit_rate.text(100);
        }else{
            final_crit_rate.text(fcr);
            affix_final_crit_rate.text(affix_fcr);
        }

        exp_dmg =  atk*(1 - final_crit_rate.text()/100 + final_crit_rate.text()/100 * (2 + crit_dmg/100)) ;
        affix_exp_dmg =  (atk+affix_atk)*(1 - affix_final_crit_rate.text()/100 + affix_final_crit_rate.text()/100 * (2 + (crit_dmg+affix_crit_dmg)/100)) ;

        limit_dmg =  atk * (2 + crit_dmg/100) ;
        affix_limit_dmg =  (atk + affix_atk)*(2 + (crit_dmg + affix_crit_dmg) / 100) ;

        if (atk) {
            exp_up.text( ( (affix_exp_dmg/exp_dmg-1) * 100 ).toFixed(2) );
            limit_up.text( ( (affix_limit_dmg/limit_dmg-1) * 100 ).toFixed(2) );
        }
    });

    // 設定teriri id
    let teriri_id = 0;

    // 生teriri
    function reburn_teriri(){
        $(".container-fluid").append(`<img src="./img/teriri.png" class="teriri" id="teriri${teriri_id}">`);
        $(`#zb${teriri_id}`).css("right", rand(10)+"%");
        $(`#zb${teriri_id}`).css("top", rand(10)+"%");
        move_teriri(teriri_id);
        teriri_id++;
    }

    // 移動teriri
    function move_teriri(teriri_id){
        $(`#teriri${teriri_id}`).animate({left: rand(80)-10+"%", top: rand(80)-10+"%"}, 3000, function(){
            move_teriri(teriri_id);
        });
    }

    $("body").on("click", ".teriri", function(){
        alert("teriri");
    });

    // 隨機 0 到 num 的數字
    function rand(num){
        return Math.floor( Math.random()*num );
    }
    
</script>
</html>